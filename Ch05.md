# Sequential Circuits

## 5-1 Sequential circuit definition

A **sequential circuit** consists of:

  * A combinatorial circuit
  * Storage elements
  
**State**: the binary information stored in the storage elements

Functions in sequential circuit:

Inputs + present state -> outputs + next state

Two types of sequential circuits:

  * Synchronous sequential circuit
  
    Depends on signals at discrete instants of time.
  
  * Asybchronous sequential circuits:
  
    Depends on inputs at any instants of time

Consider a buffer with gate delay t<sub>G</sub> with its output and input connected.

We assume:

* Signal only tranmit in single direction
* Signal will never fade
* In wire signal has no delay.

Then in the model, you will see signal

1. Appear in the buffer for t<sub>G</sub>
2. Appear in output then input then repeat 1.

From this, we know **storage can be constructed from logic with delay connected in a closed loop**.

But note, any such loop must also have a property possessed by a buffer, namely, **NO INVERSION** of signal around a complete loop.

A buffer is usually implemented with two inverters. This is one of the most popular methods of implementing storage in computer momeries. But there is no way for the information to be changed. But if we use a NOR or NAND, the information can be changed.

Sychronization may mean all signal change at a synchronized timing.

_Clock generator_ is a device to achieve synchronization. It produces a periodic train of _clock pulses_. This pulses are distributed throughout the system in such a way that synchronous storage elements are affected only in some specified  relationship to every pulse.

The key is: **the output of storage elements can change their value only in the presence of clock pulses. A transition from one state to the other occurs only at fixed time intervals dictated by th eclock pulses, giving synchronous operation**

Synchronous sequential circuit that uses a clock generator are called _clocked sequential circuits. 

## 5-2 Latches

### SR and SR-b Latches

See FIGURE 5-4 at P211.

Actually, it's derived from a two-inverter buffer by simply replacing the inverters with two NOR gates, but drawn in a differenct way.

**Why this works?**

Logic-1 is dominant in a OR gate, you can only change state to 1, but not 0. But in the latch two inversion exists. So you know why.

A _latch have two inputs and two outputs

* R(Reset) and S(Set)
* Q and Q-b

and two states

* Set state
* Reset state

I define a storage mode inputs: 

* The input that makes the circuit acts like buffer.

And transition mode inputs:

* The input that makes the circuit in a particular mode, whatever the original states
* When it changes to storage mode, the state should not change.

In all possible inputs of a latch (S, R), (0, 0) is storage mode, (0, 1), (1, 0) is transistion mode, (1, 1) is undefined.

Note in a transition mode, there is a delay between input, Q and Q_b.

A S_b R_b latch is NAND version of SR latch. The input is S_b, and R_b. It needs a 0 signal to change its state.

**Note: S_b is Set. 0 means set.

### SR Latch with a Control Input C

An input C is connected with S and R with two NOR gates such that

* C = 0 <-> storage mode
* C = 1 <-> transition mode (there's exception)

### D Latch

This latch has only two inputs: D(data) and C(control).

D input is connected with S and R with a 1-to-2-line decoder, such that

* D = 0 <-> (S, R) = (0, 1)
* D = 1 <-> (S, R) = (1, 0)

**Note in D Latch, C = 1 is transition mode, no exception.**

## 5-3 Flip-Flops

_Trigger_ is a change in value on the control input that allows the state of *a latch in a flip-flop* to switch.

_Transparent_ means input value can be seen from outputs at any time. A D-latch is transparent whenever the control input is 1.

Because of the feedback machanism, transparency may cause problems. The state of some latches may keep changing unpredictably.

_Master-slave_ flip-flop is designed for this purpose such that:

* The input presented when a clock pulse is present control its state
* The state of the flip-flop changes only when a clock pulse is not present.

Another type is edge-triggered flip-flop, which only changes its value during a transition from 0 to 1.

### Master-Slave Flip-Flops

This flip-flop consists of two latches and an inverter.

Inputs are S, R, C. The key idea is an 1-to-2-line decoder give a guarantee that **the master and the slave will never be enabled at the same time.** That is, "input accessability" and "state change" can not occur at the same time

We must remember this loop:

Latch | Normal | Postive | Negative
--- | --- | --- | ---
Master | F | T | F
Slave | T | F | T

Imagine two doors: at any point, there's always one door closed; But this structure allows information to pass through.(One piece a time though);

A error called _1s catching_ may happened. This is a problem bacause we always assume **the input pattern just before the negative edge is the transition instruction.** But if another narrow instruction occurs in the pulse then come to storage mode, it will catch that instruction. But what we assume is only storage mode occurs.

A master-slave flip-flop is called _pulse-triggered_ flip-flop. It has properties as follows:

* It responds to input values that occur anytime during its clock pulse. **Thus, if we need to know the state after one pulse, we must keep track the signal during the whole pulse.**

* The circuit must be designed so that the combinational circuit delays are short enough to prevent S and R from changing.

### Edge-Triggered Flip-Flop

Although pulse-triggered flip-flop does change its state at the edge, but how it changes depends on the whole pulse. _Edge-triggered_ flip-flop doesn't have this property. All we need to care about is the moment of _transition_.

This can be easily achieved by using a D latch instead. This is because no more storage mode is allowed when C is on.

Positive-triggered or negative-triggered properties can be interchangable if you change the position of the inverter.

### Standard Graphics Symbols

_Postponed output indicater_ shows that output signals changes at the end of the pulse.

_Dynamic indicator denotes the fact that the flip-flop responds to edge transition.

In this text, it is assumed that all flip-flops are of the positive-edge-triggered type.

_Clock gating_

_Clock skew_

### Direct Input

Flip-flops often provide special inputs for setting and resetting them asynchronously. This inputs are _direct set_ or _preset_ and _direct reset_ or _clear_. 

The direct inputs are useful for bringing flip-flops in a digital system to an initial state **prior to the normal clocked operation.**

Please refer to FIGURE 5-14 at P222. Note an upward arrow on column C indicates positive-edge-triggered type.

## 5-4 Sequential Circuit Analysis

There are two functions in sequential circuit:

* Inputs + present state = output
* Inputs + present state = next state

The first function is always "transparent", but **the second one is cut off in most time, and permitted to function once a clock period.**

See figure 5-15 at P223. A logic diagram is recognized as a synchonized sequential circuit if

* It includes flip-flops with the clock inputs driven by a clock signal.
* **Direct set/reset** is unused during the normal funcioning of the program.

Note the upper half combinational function connecting input and flip-flops are only effective when triggered.

Next we introduce:

* Input Equations
* State Table
* State Diagram

### Input Equations

As I mentioned, there are two funcitons in a sequential circuit:

* Inputs + present state = output
* Inputs + present state = next state

So there are two parts of combinational circuit and each can be described sith Boolean function. The part of combinational circuits that generates the signals for the inputs of flip-flops can be described with a _**flip-flop input equations.**_

Conventions: D<sub>A</sub> is used to denote the input D of the flip-flop with output A. Together with output function, a sequential circuit can be specified. Figure 5-15 can be specified as:

D<sub>A</sub> = AX + BX  
D<sub>B</sub> = A_bX
Y = (A + B)X_b

The first two are flip-flop inputs, the third specifies the output Y.

### State Table

A _state table_ consists of four parts: _present state_, _input_, _next state_ and _output_. Note _present state is prior to the input.

The _next states_ section shows the states at time t + 1. The output section gives the value of output Y at time t.

**To understand a state table, we see the table specified a function of input to next state and output, and the present state only specified which function to use.**

The derivation of a state table consists of:

* Listing all possible binary combinations of present state and inputs.

* Determined next-state and output from the logic diagram or flip-flop input equation.

One important relationship between next state and present flip-flop inputs:

A(t + 1) = D<sub>A</sub>(t) = AX + BX.

Present flip-flop input is the next state. And present flip-flop input is a function of present state and input.

There are two types of state table: one dimensional and two dimensional.

* _Mealy model_ circuit: output depends on both inputs and states.
* _Moore model_ circuit: depends only on states.

### State Diagram

A state diagram is represented as

* Circles denoting states
* Directed lines denoting transitions.

A state diagram is equivalent to a state table.

For a Mealy model circuits, 

* State in a circle;
* Input/output in a line;

For a Moore model circutis,

* State/output in a circle
* Input in a line.

#### Equivalent State

The essence of a "state" is the function it denotes and the next possible functions. ("Possible means different inputs lead to different functions"). **So two states are _equivalent_ if for every input sequence it will produce an identical output sequence.**

Equivalent states can be merged into a single state can connect all entrance to these states to the merged state.

#### Mixed Mealy and Moore Outputs

They can be mixed, when some of the state satisfies the definition of a Moore type output.

### Sequential Circuit Simulation

Simulation of sequential circuit involves issues not present in combinational circuits:

1. The set of input patterns must be applied in a sequence.

2. There must be some way to put the circuit in a known state.
   
   This is accomplished by application of an initialization subsequence at the beginnning of the simulation. In simplest case, this is a reset signal.

3. We need to observe the state to verify correctness. A crude approach is to add a circuit output with a path from each state vaiable signal.

4. The timing of application of inputs and observation of outputs relative to the active clock edge.

   Initially we discussed _functional simulation_ having its objective **determination or verificaiton of the function of the circuit.

   We need _timing simulation_, where elements have realistic delays.

   Several issues:

   * Delays relative to period
   * The time of application of inputs relative to the positive clock edge
   * The time at which to examine a simulation result.

## 5-5 Sequential Circuit Design

### Design Procedure

1. Specification: Description in natural language or whatever
2. Formulation: Obtain either a state diagram or state table
3. State Assignment: Assign binary codes to the states.
4. Flip-Flop Input Equation Determination: 
  * Select flip-flop types.
  * Derive equations
5. Output Equation Dtermination
6. Optimization
7. Technology Mapping: Draw a logic diagram of the circuit using flip-flops, ANDs, ORs, and inverters. Transform the logic diagram to a new diagram using the available flip-flop and gate technology.
8. Verification.

### Finding State Diagrams and State Tables

The key is an intuitive understanding of the concept of a state.

In most cases, a state is an _abstraction_ of the sequence of input combinations at the triggering points. 

For example, S<sub>1</sub> may denote the fact that "the value 1 has appeared on X for the last three consecutive clock edges."

New states equivalent to the original should be avoided. Like in the above example, a state of "00001111" should not be a new one.

When the power in a digital system is first turned on, the state of the flip-flops is unknown. It is possible to apply an input sequence (not flip-flop inputs but circuit inputs) with the circuit in an unknown state to bring the circuit to a known state.

In this chapter however, the circuit we design must ahve a known _initial state_, and a hardware mechanism is provided to get the circuit from **any** unknown state into this state. This mechanism is a _reset_ or _master reset_ signal.

The initial state is often called _reset state_. The reset signal is usually activated automatically when the circuit is powered up. In addtion, it may be activated electronically or **by pushing a reset button**.















